---
title: "How Does a Bike-Share Navigate Speedy Success?"
output:
  html_document:
    df_print: paged
---
***

## Before we start...

***
Welcome to my first notebook (with R) in my portfolio. I will be publishing two notebooks as part of the Coursera: Google Data Analytics Certification Course. This will be the first notebook for the capstone projects the course has assigned to learners. I aim to update these notebooks as I slowly gain more knowledge with using R and apply new skills / methods to perform further analysis on this case study.

***

## Introduction

***

Cyclistic (fictional company) is a bike-share program that features more than 5,800 bicycles and 600 docking stations. Cyclistic sets itself apart by also offering reclining bikes, hand tricycles, and cargo bikes, making bike-share more inclusive to people with disabilities and riders who can’t use a standard two-wheeled bike. The majority of riders opt for traditional bikes; about 8% of riders use the assistive options. Cyclistic users are more likely to ride for leisure, but about 30% use them to commute to work each day.


Until now, Cyclistic’s marketing strategy relied on building general awareness and appealing to broad consumer segments.
One approach that helped make these things possible was the flexibility of its pricing plans: single-ride passes, full-day passes, and annual memberships. Customers who purchase single-ride or full-day passes are referred to as **casual riders**. Customers who purchase annual memberships are **Cyclistic members**.


Cyclistic’s finance analysts have concluded that *annual members are much more profitable than casual riders*. Although the pricing flexibility helps Cyclistic attract more customers, **Lily Moreno, the director of marketing**, believes that maximizing the number of annual members will be key to future growth. Rather than creating a marketing campaign that targets all-new customers, Moreno believes there is a very good chance to convert casual riders into members. She notes that casual riders are already aware of the Cyclistic program and have chosen Cyclistic for their mobility needs.


Moreno has set a clear goal: **Design marketing strategies aimed at converting casual riders into annual members**. In order to do that, however, the marketing analyst team needs to better understand how annual members and casual riders differ, why casual riders would buy a membership, and how digital media could affect their marketing tactics.Moreno and her team is interested in analyzing the Cyclistic historical bike trip data to identify trends.


Three questions will guide the future marketing program:

1. How do annual members and casual riders use Cyclistic bikes differently?
2. Why would casual riders buy Cyclistic annual memberships?
3. How can Cyclistic use digital media to influence casual riders to become members?


Moreno has assigned us the first question to answer: **How do annual members and casual riders use Cyclistic bikes differently?**

***

## Preparing and Processing data

***
We will be using Cyclistic’s historical trip data to analyze and identify trends. This includes the previous 12 months of
Cyclistic's trip data.

```{r}
library(tidyverse)
library(lubridate)
library(geosphere)
library(outliers)
```

```{r}
data_files <- list.files(pattern = "*.csv")
df_list <- lapply(data_files, read_csv)
cyclistic_df <- bind_rows(df_list)
```
```{r}
# Now, we will do an initial inspection of our data frame to get a glimpse of what our data frame holds.

str(cyclistic_df)
```
```{r}
head(cyclistic_df, 10)
```

```{r}
summary(cyclistic_df)
```
```{r}
# Let's check if there are any duplicate entries in our data frame.
sum(duplicated(cyclistic_df))
```
```{r}
#Now, let's check the type of bikes Cyclistic has in their service.
cyclistic_df %>%
  distinct(rideable_type)
```
***

Let's check the individual columns for null values and drop these rows.
(After coming back to review this project, I realised I should instead drop the rows with the end_lat and end_lng values null, whilst preserving the rows with start_station_name and start_station_id values as null.

***
```{r}
colSums(is.na(cyclistic_df))

cyclistic_df_new <- drop_na(cyclistic_df)
```
***

Now, let's create a new data frame with new variables to conduct our analysis later on. We'll create columns reflecting values for ride length, day of ride, time of ride and ride distance.

***
```{r}

cyclistic_df_new <- mutate(cyclistic_df_new, ride_length_seconds = round(difftime(ended_at, started_at, units = "secs")))
cyclistic_df_new <- mutate(cyclistic_df_new, ride_length_mins = round(difftime(ended_at, started_at, units = "mins"), digits = 1))
cyclistic_df_new <- mutate(cyclistic_df_new, day_of_week = weekdays(as.Date(cyclistic_df_new$started_at)))
cyclistic_df_new <- mutate(cyclistic_df_new, start_time = format(started_at, format = "%H:%M:%S"))
cyclistic_df_new <- mutate(cyclistic_df_new, end_time = format(ended_at, format = "%H:%M:%S"))

cyclistic_df_new$ride_length_seconds <- as.numeric(cyclistic_df_new$ride_length_seconds)
cyclistic_df_new$ride_length_mins <- as.numeric(cyclistic_df_new$ride_length_mins)
```

***

Calculating distance using a function from the geosphere library. The formulas in this library does not differ too much in calculations output. Hence, I decided to use the distHaversine function that uses the Haversine formula to find the distance between two points on a sphere.

***
```{r}

cyclistic_df_new$ride_distance <- distHaversine(matrix(c(cyclistic_df_new$start_lng, cyclistic_df_new$start_lat), 
                                                       ncol = 2), 
                                                matrix(c(cyclistic_df_new$end_lng, cyclistic_df_new$end_lat), 
                                                       ncol = 2))

# The default units for the fns() in geosphere is meters by default. I'm going to change this to km (dividing by 1000)
cyclistic_df_new$ride_distance <- cyclistic_df_new$ride_distance / 1000


```

```{r}
#Let's take a look at our new data frame.
head(cyclistic_df_new, 10)
```
```{r}
summary(cyclistic_df_new)
str(cyclistic_df_new)
```
***
I noticed that the minimum ride length is below 0 (-7745) and the minimum ride distance is 0. Both values are impossible / does not make sense and we'll be dropping those rows.Stated in the guide script provided to us is that, "*the data frame includes a few hundred entries when bikes were taken out of docks and checked for quality by Divvy*", which could explain why some values were as such (below 0).

***
```{r}

cyclistic_df_new <- cyclistic_df_new %>%
  filter(ride_distance > 0 & ride_length_seconds > 0)
```

***

Sampling data set with sample size of 666 based on 99% confidence, 5% margin of error and 6.7 million population size. The sample size was calculated by an online sample size calculator.

***
```{r}

sampled_cyclistic <- sample_n(cyclistic_df_new, size = 666, replace = FALSE)
summary(sampled_cyclistic)
```
***

## Analysis

***

### Average ride time grouped by rider types
```{r}

avg_ride_time_member_secs <- sampled_cyclistic %>%
  group_by(member_casual) %>%
  summarise(mean_ride_time = mean(ride_length_seconds))

avg_ride_time_viz <- ggplot(avg_ride_time_member_secs, aes(x=member_casual, y=mean_ride_time, fill=member_casual)) +
  geom_col() +
  labs(title="Average ride time: Members vs Casuals", x="Rider type", y="Ride time (seconds)")

avg_ride_time_viz
```
***

### Average distance travelled, grouped by rider types
```{r}

avg_ride_dist_member <- sampled_cyclistic %>%
  group_by(member_casual) %>%
  summarise(mean_distance = mean(ride_distance))

avg_ride_dist_viz <- ggplot(avg_ride_dist_member, aes(x=member_casual, y=mean_distance, fill=member_casual)) +
  geom_col() +
  labs(title="Average ride distance: Members vs Casuals", x="Rider type", y="Average ride distance (KM)")

avg_ride_dist_viz
```
***

These two visualizations tells us both rider types ride their bikes more or less the same distances, but casual riders are spending longer times on their journeys than members. This suggests that casual riders, well, take their rides *casually* while members are riding their bikes in a hurry (probably rushing off to work?).

***

### Ride count in a week, grouped by rider type

```{r}
daily_rides_member <- sampled_cyclistic %>%
  mutate(day_of_week = wday(started_at, label = TRUE)) %>%
  group_by(member_casual, day_of_week) %>%
  summarise(daily_count = n())

daily_rides_member_viz <- ggplot(daily_rides_member, aes(x=day_of_week, y=daily_count, fill=member_casual)) +
  geom_col(position = "dodge") +
  labs(title="Ride count in a week, by rider type", x="Days", y="Ride count")

daily_rides_member_viz
```
***

It gets even more interesting here. We can see that on the weekdays, members use the bikes more than the casual riders. However, on the weekends, it's the casual riders that use the bikes more than the members. Could this be because during the weekdays, members are using these bikes more to reach work (kind of creating a "peak hour bike rush") and leaving lesser bikes for the casual riders to use? 

Or could it be because of the subscription type of payment scheme,

*(remember earlier in the introduction, "Customers who purchase single-ride or full-day passes are referred to as **casual riders**. Customers who purchase annual memberships are **Cyclistic members**)*,

where it would be cheaper overall to get annual memberships rather than paying on a per ride basis? Due to this, casual riders may not be interested to use these bikes and resort to other modes of commute.

***

### Bike usage comparison between rider types.

```{r}
total_bike_usage <- sampled_cyclistic %>%
  filter(rideable_type != "docked_bike") %>%
  group_by(member_casual, rideable_type) %>%
  summarise(sum_bike_usage = n())

total_bike_usage_viz <- ggplot(total_bike_usage, aes(x=member_casual, y=sum_bike_usage, fill=rideable_type)) +
  geom_col(position = "dodge") +
  scale_y_discrete(limits = c(0, 50, 100, 150, 200, 250)) +
  labs(title="Bike usage between members", x="Rider type", y="Usage Count")

total_bike_usage_viz
```
***
### Average ride time between bikes (grouped by members)

```{r}
avg_bike_duration <- sampled_cyclistic %>%
  filter(rideable_type != "docked_bike") %>%
  group_by(member_casual, rideable_type) %>%
  summarise(avg_bike_usage = mean(ride_length_seconds))

avg_bike_usage_viz <- ggplot(avg_bike_duration, aes(x=member_casual, y=avg_bike_usage, fill=rideable_type)) +
  geom_col(position = "dodge") +
  labs(title="Average ride duration by bikes", x="Rider type", y="Ride time (secs)")

avg_bike_usage_viz
```
***

### Bike usage throughout the week (grouped by member type)

```{r}
bike_usage_thru_week <- sampled_cyclistic %>%
  mutate(day_of_week = wday(started_at, label = TRUE)) %>%
  filter(rideable_type != "docked_bike") %>%
  group_by(member_casual, rideable_type, day_of_week) %>%
  summarise(daily_total = n())

avg_bike_usage_week_viz <- ggplot(bike_usage_thru_week, aes(x=day_of_week, y=daily_total, fill=rideable_type)) +
  geom_col(position = "dodge") +
  facet_grid(~member_casual) +
  labs(title="Average bike usage in a week", x="Days", y="Total usage count")
avg_bike_usage_week_viz
```
***

From these three visualisations, we can deduce that the classic bikes are favoured by both the casual and member riders over the electric bikes. This could point to a specific scenario: 

A rider (regardless of membership type) decides to commute to work on an electric bike. The rider wants to take it easy and let the battery powered motor do all the work for him, since it's an electric bike. However, the battery runs out of charge mid-trip and the rider has to resort to pedalling manually, and it's a workout for sure because of the extra weight with the battery on the bike. After that experience, the rider decides to use the classic bikes from then on.

This kind of experiences might have lead to riders wanting to use the more "reliable" classic bike as there is one less contributing factor to your trip being ruined.

***

## Conclusion

***

From these insights, we not only have information on how do annual members and casual riders differ in the usage of Cyclistic bikes. We could also make improvements on their experience using the bikes. 

We could look into the pricing plans and make changes to attract the casual riders to purchase an annual membership plan instead of sticking with the pay per ride/day basis.

We could also improve our maintenance of the electric bikes to ensure that they are adequately charged for repeated usage. A good place to start is to increase the frequency we bring in electric bikes for charging.

***

## Reflection

***

After completing this project, I realised several things:

- I could have cleaned the data better / ensured more accurate data by dealing with rows with null values better. In hindsight, there were rows that should not have been dropped (rows with empty longitude / latitude values).

- I was actually stuck at one point of this project as I wanted to analyse the spread of the values for ride distance and ride durations. However, upon doing so, the results were not normally distributed:

***
```{r}
ride_length_spread <- ggplot(sampled_cyclistic, aes(x=ride_length_seconds)) +
  geom_histogram() +
  labs(title="Ride length spread")

ride_length_spread
```
```{r}
# mean (ride length in seconds) = 972.1381 secs
mean(sampled_cyclistic$ride_length_seconds)

# mean (ride distance in km) = 2.133668 km
mean(sampled_cyclistic$ride_distance)

# median (ride length in seconds) = 649 secs
median(sampled_cyclistic$ride_length_seconds)

# median (ride distance in km) = 1.666904 km
median(sampled_cyclistic$ride_distance)

outlier(sampled_cyclistic$ride_length_seconds) # 24226 seconds
```
***

The distribution was heavily right-skewed because the median was much lower than the mean. I then applied log transformation to fix the distribution...

***

```{r}
ride_length_spread <- ggplot(sampled_cyclistic, aes(x=log(ride_length_seconds))) +
  geom_histogram() +
  labs(title="Ride length spread")

ride_length_spread
```
***

... and the distribution looks better than the previous one. However, I did not know how to move on after this step because I was not sure what to do with this step. I intended to to a one-sample-t-test to check if the sample mean was representative of the population but I got stuck here (was I actually supposed to use this distribution for the one-sample-t-test?)

- I will definitely be adding on to this case study every now and then as I learn more about statistics!

***

***

## Thank you!

***

This concludes case study 1 of the Google Data Analytics Capstone Project.

***
